# ğŸ”¹ 1ë‹¨ê³„: gradle:8.12-jdk17ë¥¼ ë„ì›Œì„œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Docker Containerë¥¼ ë„ìš´ë‹¤.
FROM gradle:8.12-jdk17 AS build
WORKDIR /home/gradle/project

# gradle ëª…ë ¹ ì‹¤í–‰ì— í•„ìš”í•œ ì „ì²´ ì†ŒìŠ¤ ë³µì‚¬
# (Dockerfileì˜ . ìœ„ì¹˜ -> docker containerì˜ . ìœ„ì¹˜ë¡œ ì´ë™)
COPY --chown=gradle:gradle . .

# Gradle ë¹Œë“œ (Spring Boot pluginì´ ì ìš©ë˜ì–´ ìˆì–´ì•¼ í•¨)
RUN gradle clean bootJar --no-daemon

# ğŸ”¹ 2ë‹¨ê³„: ì‹¤í–‰ìš© ì´ë¯¸ì§€
FROM eclipse-temurin:17-jdk AS runtime
WORKDIR /app

# ë¹Œë“œëœ jar ë³µì‚¬
COPY --from=build /home/gradle/project/build/libs/*.jar app.jar

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (í•„ìš” ì‹œ SPRING_PROFILES_ACTIVE ë³€ê²½ ê°€ëŠ¥)
ENV JAVA_OPTS="-Duser.timezone=Asia/Seoul" \
    SPRING_PROFILES_ACTIVE=dev

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# ë¹„ë£¨íŠ¸ ì‚¬ìš©ìë¡œ ì‹¤í–‰
USER 1001

# ENTRYPOINT - JAVA_OPTSë¥¼ í™•ì¥ ê°€ëŠ¥í•˜ê²Œ
ENTRYPOINT ["sh", "-c", "java ${JAVA_OPTS} -jar app.jar"]